# Real-World Example of writing software exploitation
1. Env
- Any linux in VM. (suggest lightweight Debian-based, use XFCE). Ubuntu + XFCE4 is okay
- Install Escan Antivirus 7.32 `https://escanav.com/en/antivirus-downloadlink/downloadproduct.asp?pcode=ES-LNHMv9&srsltid=AfmBOoqsrDzsFhMhB60s9YUNNKMZWPs-YpT4tiS5XnoTZ6kpE4yfIzdJ` (use Deb 64 bit)

# 2. Exploitation
## Lỗ hổng bảo mật
Là lỗi trong phần mềm (thiết kế, triển khai, vận hành), cho phép threat actor lợi dụng để thực hiện hành động trái phép lên dữ liệu. Nếu phân chia theo attack vector, bên cạnh việc đánh cắp dữ liệu hoặc làm gián đoạn hệ thống chúng ta có:
- Remote attack (tấn công từ xa): chiếm quyền kiểm soát hệ thống => Malware sử dụng để lây nhiễm thay vì đánh lừa người dùng qua phishing.
- Local attack: leo thang đặc quyền -> thực hiện hành động dưới quyền của user khác. mục đích nhằm kiểm soát tài nguyên của user đó => Malware sử dụng để đánh cắp thông tin nhạy cảm trong hệ thống hoặc sửa đổi dữ liệu trong hệ thống.

## Khai thác lỗ hổng (mindset)
- Xảy ra lỗi khi tiến trình chạy dưới quyền cao hơn (hoặc quyền user khác - in general) xử lý dữ liệu từ user khác (và threat actor kiểm soát được dữ liệu này)
Ví dụ: cấp thừa (sai) quyền, kiểm tra sai điều kiện được thực thi, thực thi không an toàn, ...
https://cwe.mitre.org/data/definitions/265.html

## Cách malware sử dụng
-> mang theo script exploit để chiếm quyền cao hơn hoặc lừa người dùng chạy với quyền cao hơn?
-> sử dụng thế nào, tại sao

# 3. Practical attack 0: Tìm hiểu về target

2.1 Examine and discovery
- Thử tìm thông tin về installation thông qua systemd unit và init.d
- Thử tìm thông tin về installation thông qua lệnh find
- Thử tìm thông tin thông qua desktop entry
- Thử tìm thông qua apt / dpkg
- Kiểm tra thông qua lệnh ps
=>> Thu thập thông tin, biết được cài đặt trong `/opt/MicroWorld/` và các thông tin hữu ích khác.

# 4. Practical attack 1: Kiểm tra sai điều kiện thực thi

# 5. Practical attack 2: cấp thừa quyền

# 6. Practical attack 3: Thực thi không an toàn với quyền hạn cao

2.2 Priv Esc enumeration:
- Thử sử dụng module tìm suid binary đối với eScan
=> Sửa đổi script để scan `/opt/`, thấy có 2 suid binary
- Thử sử dụng module tìm writable directory đối với eScan
=> Sửa đổi script tìm writable directory với target `/opt/` và `/var` (có thể cụ thể hơn bằng path của eScan), phát hiện một số thư mục cho phép user ghi vào thư mục có owner root
2.3 Priv Esc exploitation:
- Dịch ngược, phân tích và viết exploit cho CVE-2023-4383.
 + Dịch ngược và phân tích luồng logic của `runasroot`
 + Hiểu logic code của việc cho phép thực thi lệnh chmod
 + Hiểu bug gây ra lỗ hổng cho phép thực thi ngoài ý muốn
 + Viết script khai thác lỗ hổng leo thang đặc quyền
- Dịch ngược, phân tích và viết exploit leo thang đặc quyền bằng cách chain CVE-2024-13188 và CVE-2025-0720
 + Sử dụng strace để xem việc `rtscanner` gọi các thư viện
 + Từ kết quả, kết hợp với kết quả enumerate, phân tích hướng thực hiện và viết exploit
 + Kết hợp với CVE-2025-0720 để trigger lỗ hổng

3. Bài tập:
- Phân tích và viết script khai thác CVE-2025-0798
- Viết script kiểm tra các lỗ hổng có thể tồn tại hay không? (ví dụ: dựa vào version patch, dựa vào một số artifact, ...).
- Bonus: viết module exploit cho Metasploit
